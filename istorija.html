<!DOCTYPE html>
<html lang="sr">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Istorija utakmica</title>
      <script type="module" src="firebase.mjs"></script>
      <style>
         @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
         :root {
         --bg-a: #ecf6ff;
         --bg-b: #f5fffb;
         --ink: #0f172a;
         --muted: #5b667a;
         --brand: #0b66b8;
         --card-border: #dce7f5;
         }
         * {
         box-sizing: border-box;
         margin: 0;
         padding: 0;
         }
         body {
         font-family: 'Plus Jakarta Sans', 'Avenir Next', 'Segoe UI', sans-serif;
         background:
           radial-gradient(1200px 420px at 10% -10%, rgba(17, 120, 200, 0.15), transparent 55%),
           radial-gradient(1000px 360px at 100% 0%, rgba(14, 165, 166, 0.12), transparent 45%),
           linear-gradient(180deg, var(--bg-a) 0%, var(--bg-b) 100%);
         min-height: 100vh;
         padding: 20px;
         color: var(--ink);
         }
         .logo {
         font-size: 22px;
         font-weight: 600;
         color: #6c72e6;
         display: flex;
         align-items: center;
         gap: 10px;
         }
         .link-back {
         display: inline-block;
         color: white;
         text-decoration: none;
         font-size: 16px;
         font-weight: 500;
         padding: 10px 20px;
         background: rgba(255, 255, 255, 0.2);
         border-radius: 10px;
         transition: all 0.3s ease;
         backdrop-filter: blur(10px);
         }
         .link-back:hover {
         background: rgba(255, 255, 255, 0.3);
         transform: translateX(-3px);
         }
         .container {
         max-width: 900px;
         margin: 0 auto;
         }
         h1 {
         color: var(--brand);
         margin-bottom: 28px;
         font-size: 32px;
         text-align: center;
         font-weight: 700;
         }
         /* Back button at top */
         .back-button-top {
         display: flex;
         justify-content: space-between;
         align-items: center;
         gap: 10px;
         margin-bottom: 30px;
         }
         #themeToggle {
         border: 1px solid rgba(188, 210, 232, 0.9);
         background: rgba(255, 255, 255, 0.75);
         color: var(--brand);
         border-radius: 10px;
         min-height: 36px;
         padding: 7px 12px;
         font-size: 11px;
         font-weight: 800;
         letter-spacing: 0.03em;
         cursor: pointer;
         transition: all 0.2s ease;
         }
         #themeToggle:hover {
         background: var(--brand);
         color: #fff;
         }
         .back-btn {
         background: transparent;
         border: none;
         color: var(--brand);
         padding: 6px 0;
         font-weight: 600;
         }
         .back-btn:hover {
         text-decoration: underline;
         transform: none;
         }
         .back-btn:active {
         transform: translateY(0);
         }
         #historyList {
         animation: fadeIn 0.5s ease-in;
         }
         @keyframes fadeIn {
         from { opacity: 0; transform: translateY(20px); }
         to { opacity: 1; transform: translateY(0); }
         }
         .match-box {
         background: white;
         padding: 25px;
         border-radius: 16px;
         margin-bottom: 20px;
         box-shadow: 0 14px 32px rgba(15, 23, 42, 0.08);
         border: 1px solid var(--card-border);
         transition: transform 0.3s ease, box-shadow 0.3s ease;
         }
         .match-box:hover {
         transform: translateY(-4px);
         box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
         }
         .match-meta {
         color: var(--muted);
         margin-bottom: 15px;
         font-size: 14px;
         font-weight: 500;
         display: flex;
         justify-content: space-between;
         align-items: center;
         flex-wrap: wrap;
         gap: 10px;
         }
         .match-links {
         display: flex;
         gap: 12px;
         flex-wrap: wrap;
         }
         .info-link {
         color: var(--brand);
         cursor: pointer;
         font-size: 14px;
         text-decoration: none;
         font-weight: 500;
         padding: 6px 12px;
         background: #eff7ff;
         border-radius: 8px;
         border: none;
         transition: all 0.2s ease;
         display: inline-flex;
         align-items: center;
         gap: 4px;
         }
         .info-link:hover {
         background: var(--brand);
         color: white;
         transform: translateY(-2px);
         box-shadow: 0 0 0 2px rgba(11, 102, 184, 0.18);
         }
         .match-teams {
         display: flex;
         justify-content: space-around;
         align-items: center;
         margin-top: 15px;
         }
         .team-logo {
         width: 130px;
         height: 130px;
         object-fit: contain;
         padding: 10px;
         border-radius: 14px;
         background: transparent;
         box-shadow: none;
         transition: transform 0.3s ease;
         }
         .team-logo:hover {
         transform: scale(1.1);
         }
         .team-name {
         font-weight: 600;
         font-size: 15px;
         margin-top: 8px;
         }
         .team-col {
         text-align: center;
         }
         .team-name-red {
         color: #c00000;
         }
         .team-name-blue {
         color: #0044cc;
         }
         .score {
         font-size: 34px;
         font-weight: 800;
         margin: 10px 0;
         color: #2d3436;
         min-width: 120px;
         text-align: center;
         }
         .score .red {
         color: #d63031;
         }
         .score .blue {
         color: #0984e3;
         }
         /* Captain and Goalkeeper badges */
         .captain-badge {
         display: inline-block;
         background: linear-gradient(135deg, #ffd700, #ffed4e);
         color: #333;
         font-weight: bold;
         padding: 3px 7px;
         border-radius: 5px;
         margin-left: 8px;
         font-size: 11px;
         box-shadow: 0 2px 6px rgba(0,0,0,0.15);
         border: 1px solid #daa520;
         }
         .goalkeeper-badge {
         margin-left: 8px;
         font-size: 18px;
         }
         .scorer-item {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 5px 8px;     /* +1px vertikalno */
         margin: 2px 0;       /* +1px izmeƒëu redova */
         font-size: 13px;
         font-weight: 500;
         line-height: 1.15;   /* mrvicu rastereƒáenje */
         border-radius: 4px;
         }
         .scorer-item:hover {
         background-color: rgba(0,0,0,0.02);
         }
         .scorer-item.red {
         background: #fff5f5;
         color: #d63031;
         border-left: 2px solid #d63031;
         }
         .scorer-item.blue {
         background: #f5f9ff;
         color: #0984e3;
         border-left: 2px solid #0984e3;
         }
         /* MODAL */
         #modalOverlay {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.6);
         backdrop-filter: blur(8px);
         justify-content: center;
         align-items: center;
         z-index: 1000;
         animation: fadeInOverlay 0.3s ease;
         }
         @keyframes fadeInOverlay {
         from { opacity: 0; }
         to { opacity: 1; }
         }
         #modalBox {
         background: white;
         max-width: 600px;
         width: 90%;
         max-height: 80vh;
         overflow: hidden;
         padding: 0;
         border-radius: 16px;
         text-align: left;
         box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
         margin: 20px;
         animation: slideUp 0.3s ease;
         display: flex;
         flex-direction: column;
         }
         @keyframes slideUp {
         from { transform: translateY(50px); opacity: 0; }
         to { transform: translateY(0); opacity: 1; }
         }
         .modal-head {
         position: sticky;
         top: 0;
         z-index: 5;
         display: flex;
         align-items: center;
         justify-content: space-between;
         gap: 12px;
         padding: 16px 18px;
         border-bottom: 1px solid #e8eef7;
         background: linear-gradient(180deg, #ffffff 0%, #f7faff 100%);
         }
         #modalBox h2 {
         color: #333;
         margin: 0;
         font-size: 22px;
         line-height: 1.2;
         }
         #closeModal {
         cursor: pointer;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         width: 36px;
         height: 36px;
         border-radius: 999px;
         border: 1px solid #dbe5f4;
         background: #fff;
         font-size: 22px;
         color: #334155;
         line-height: 1;
         transition: all 0.2s ease;
         outline: none;
         flex-shrink: 0;
         }
         #closeModal:hover {
         background: var(--brand);
         color: white;
         transform: rotate(90deg);
         }
         #closeModal:focus {
         box-shadow: 0 0 0 3px rgba(11, 102, 184, 0.3);
         }
         #modalContent {
         padding: 16px 18px 18px;
         overflow-y: auto;
         max-height: calc(80vh - 74px);
         }
         .empty-state {
         text-align: center;
         padding: 60px 20px;
         color: white;
         font-size: 18px;
         opacity: 0.9;
         }
         /* MOBILE STYLES */
         @media (max-width: 768px) {
         body {
         padding: 15px;
         }
         header {
         padding: 15px 20px;
         margin-bottom: 20px;
         }
         .logo {
         font-size: 22px;
         }
         h1 {
         font-size: 26px;
         margin-bottom: 20px;
         }
         .link-back {
         font-size: 14px;
         padding: 10px 16px;
         }
         .back-button-top {
         margin-bottom: 20px;
         }
         .back-btn {
         width: 100%;
         padding: 14px;
         font-size: 15px;
         }
         .match-box {
         padding: 18px;
         margin-bottom: 26px;
         }
         .match-meta {
         font-size: 12px;
         flex-direction: column;
         align-items: flex-start;
         gap: 8px;
         }
         .match-links {
         gap: 8px;
         }
         .info-link {
         font-size: 12px;
         padding: 5px 10px;
         min-height: 36px;
         }
         .team-logo {
         width: 60px;
         height: 60px;
         }
         .match-teams .team-logo {
         width: 100px;
         height: 100px;
         }
         .team-name {
         font-size: 13px;
         margin-top: 6px;
         }
         .score {
         font-size: 32px;
         }
         .scorer-item {
         font-size: 14px;
         padding: 10px 14px;
         }
         #modalBox {
         width: 95%;
         padding: 0;
         margin: 10px;
         }
         #modalBox h2 {
         font-size: 19px;
         }
         #closeModal {
         width: 34px;
         height: 34px;
         font-size: 20px;
         }
         .captain-badge {
         font-size: 9px;
         padding: 2px 5px;
         margin-left: 5px;
         }
         .goalkeeper-badge {
         font-size: 15px;
         margin-left: 5px;
         }
         }
         @media (max-width: 480px) {
         h1 {
         font-size: 22px;
         }
         .match-box {
         padding: 15px;
         }
         .team-logo {
         width: 50px;
         height: 50px;
         }
         .team-name {
         font-size: 12px;
         }
         .score {
         font-size: 28px;
         margin: 8px 0;
         }
         .match-meta {
         font-size: 11px;
         }
         .info-link {
         font-size: 11px;
         padding: 4px 8px;
         }
         .match-teams {
         gap: 8px;
         }
         #modalBox {
         padding: 0;
         }
         .captain-badge {
         font-size: 8px;
         padding: 1px 4px;
         }
         .goalkeeper-badge {
         font-size: 13px;
         }
         }
         @media (max-width: 640px) {
         .match-teams {
         flex-wrap: nowrap;
         justify-content: space-between;
         gap: 8px;
         }
         .score {
         width: auto;
         margin-top: 0;
         min-width: 76px;
         }
         .match-teams > .team-col {
         flex: 1;
         min-width: 0;
         }
         }
         @media (max-width: 360px) {
         .match-box {
         padding: 12px;
         }
         .match-meta {
         gap: 6px;
         font-size: 11px;
         margin-bottom: 10px;
         }
         .match-links {
         gap: 4px;
         }
         .info-link {
         font-size: 10px;
         padding: 4px 8px;
         min-height: 30px;
         }
         .match-teams {
         gap: 4px;
         }
         .match-teams .team-logo {
         width: 58px;
         height: 58px;
         }
         .team-name {
         font-size: 12px;
         margin-top: 4px;
         }
         .score {
         font-size: 22px;
         min-width: 62px;
         margin: 0;
         }
         }
         a:focus-visible,
         button:focus-visible,
         .info-link:focus-visible {
         outline: 3px solid var(--brand);
         outline-offset: 2px;
         }
         @media (prefers-reduced-motion: reduce) {
         * {
         animation: none !important;
         transition: none !important;
         scroll-behavior: auto !important;
         }
         }
         /* === Redesign V2 === */
         .container {
         max-width: 980px;
         }
         h1 {
         letter-spacing: -0.02em;
         margin-bottom: 22px;
         }
         .back-btn {
         display: inline-flex;
         align-items: center;
         gap: 8px;
         padding: 10px 14px;
         border-radius: 12px;
         background: rgba(255, 255, 255, 0.7);
         border: 1px solid rgba(188, 210, 232, 0.7);
         box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
         text-decoration: none;
         }
         .match-box {
         border-radius: 20px;
         border: 1px solid rgba(214, 227, 242, 0.95);
         box-shadow: 0 20px 45px rgba(15, 23, 42, 0.12);
         }
         .match-meta {
         font-size: 13px;
         gap: 12px 16px;
         }
         .match-teams {
         gap: 20px;
         }
         .team-logo {
         width: clamp(90px, 14vw, 128px);
         height: clamp(90px, 14vw, 128px);
         border-radius: 16px;
         }
         .score {
         font-size: clamp(28px, 4vw, 38px);
         letter-spacing: -0.02em;
         }
         .info-link {
         border-radius: 12px;
         font-weight: 700;
         min-height: 36px;
         padding: 8px 12px;
         }
         #modalBox {
         max-width: 660px;
         border-radius: 20px;
         box-shadow: 0 30px 80px rgba(2, 6, 23, 0.42);
         }
         .modal-head {
         padding: 14px 16px;
         }
         #modalContent {
         padding: 16px;
         }
         #closeModal {
         width: 36px;
         height: 36px;
         border-radius: 10px;
         }
         @media (max-width: 768px) {
         .match-box {
         border-radius: 16px;
         padding: 18px;
         }
         .match-meta {
         font-size: 12px;
         }
         #modalBox {
         width: 94%;
         max-height: 86vh;
         border-radius: 16px;
         }
         }
         body.modal-open {
         position: fixed;
         width: 100%;
         overflow: hidden;
         touch-action: none;
         }
         #modalContent {
         padding: 0 16px 16px;
         }
         .modal-subtitle {
         margin: 0;
         font-size: 12px;
         font-weight: 600;
         color: #64748b;
         letter-spacing: 0.05em;
         text-transform: uppercase;
         }
         .modal-tabs-shell {
         position: sticky;
         top: 0;
         z-index: 3;
         margin: 6px -16px 12px;
         padding: 0 16px 10px;
         background: #ffffff;
         border-bottom: 1px solid #e8eef7;
         box-shadow: 0 6px 12px rgba(15, 23, 42, 0.06);
         }
         .modal-tabs {
         display: flex;
         flex-wrap: nowrap;
         gap: 8px;
         overflow-x: auto;
         padding-bottom: 2px;
         }
         .modal-tabs::-webkit-scrollbar {
         height: 4px;
         }
         .modal-tabs::-webkit-scrollbar-thumb {
         background: rgba(148, 163, 184, 0.45);
         border-radius: 999px;
         }
         .modal-tab {
         border: 1px solid #d8e4f5;
         background: #f6faff;
         color: #325072;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         min-height: 32px;
         min-width: 86px;
         padding: 6px 10px;
         border-radius: 10px;
         font-size: 12px;
         font-weight: 700;
         cursor: pointer;
         transition: all 0.2s ease;
         white-space: nowrap;
         }
         .modal-tab.active {
         background: linear-gradient(135deg, #0b66b8 0%, #0ea5a6 100%);
         border-color: transparent;
         color: #fff;
         box-shadow: 0 6px 16px rgba(11, 102, 184, 0.25);
         }
         .modal-panel {
         animation: modalPanelIn 0.18s ease;
         }
         @keyframes modalPanelIn {
         from { opacity: 0; transform: translateY(6px); }
         to { opacity: 1; transform: translateY(0); }
         }
         .modal-info-card {
         border: 1px solid #e3ecf9;
         border-radius: 12px;
         background: linear-gradient(180deg, #ffffff 0%, #f7fbff 100%);
         padding: 14px;
         color: #1f2937;
         line-height: 1.6;
         white-space: pre-line;
         }
         .modal-empty {
         margin: 0;
         text-align: center;
         color: #64748b;
         background: #f8fbff;
         border: 1px dashed #d8e4f5;
         border-radius: 12px;
         padding: 14px;
         font-weight: 600;
         }
         .scorers-list {
         display: flex;
         flex-wrap: wrap;
         gap: 8px;
         }
         .scorer-row {
         display: inline-flex;
         align-items: center;
         gap: 8px;
         padding: 7px 10px;
         border-radius: 999px;
         border: 1px solid #dbe4f0;
         background: #fff;
         min-height: 34px;
         max-width: 100%;
         }
         .scorer-row.red {
         background: #fff1f2;
         border-color: #fecdd3;
         }
         .scorer-row.blue {
         background: #eff6ff;
         border-color: #bfdbfe;
         }
         .scorer-main {
         min-width: 0;
         display: inline-flex;
         align-items: center;
         gap: 6px;
         }
         .scorer-name {
         font-size: 12px;
         font-weight: 700;
         color: #0f172a;
         line-height: 1;
         display: flex;
         align-items: center;
         gap: 6px;
         white-space: nowrap;
         }         .scorer-goals {
         min-width: 34px;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         padding: 2px 7px;
         border-radius: 999px;
         font-size: 11px;
         font-weight: 800;
         color: #0f172a;
         border: 1px solid rgba(148, 163, 184, 0.4);
         background: rgba(255, 255, 255, 0.85);
         }
         .scorer-goals.red {
         color: #b91c1c;
         border-color: #fecaca;
         background: #fff1f2;
         }
         .scorer-goals.blue {
         color: #075985;
         border-color: #bfdbfe;
         background: #eff6ff;
         }
         .own-goal-note {
         margin-top: 10px;
         border: 1px dashed #f8b4b4;
         background: #fff7f7;
         color: #9f1239;
         border-radius: 12px;
         padding: 10px 12px;
         font-size: 12px;
         font-weight: 700;
         }
         .lineup-unified-card {
         border: 1px solid #e3ecf9;
         border-radius: 12px;
         padding: 12px;
         background: #f9fcff;
         }
         .lineup-pitch {
         position: relative;
         width: 100%;
         max-width: 420px;
         margin: 0 auto;
         aspect-ratio: 2 / 3;
         background: url('field.png') center / cover no-repeat;
         border-radius: 12px;
         border: 1px solid rgba(148, 163, 184, 0.35);
         box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.55);
         overflow: hidden;
         }
         .lineup-node {
         position: absolute;
         transform: translate(-50%, -50%);
         display: flex;
         flex-direction: column;
         align-items: center;
         gap: 4px;
         max-width: 34%;
         }
         .lineup-dot {
         width: 20px;
         height: 20px;
         border-radius: 999px;
         border: 2px solid #ffffff;
         box-shadow: 0 3px 8px rgba(15, 23, 42, 0.28);
         }
         .lineup-node.red .lineup-dot {
         background: radial-gradient(circle at 30% 30%, #ff7d7d, #d63031 62%);
         }
         .lineup-node.blue .lineup-dot {
         background: radial-gradient(circle at 30% 30%, #74b6ff, #0984e3 62%);
         }
         .lineup-label {
         font-size: 10px;
         font-weight: 700;
         line-height: 1.2;
         padding: 3px 6px;
         border-radius: 999px;
         color: #0f172a;
         background: rgba(255, 255, 255, 0.93);
         border: 1px solid rgba(203, 213, 225, 0.85);
         box-shadow: 0 2px 6px rgba(15, 23, 42, 0.12);
         text-align: center;
         max-width: 100%;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
         }
         .lineup-node.red .lineup-label {
         border-color: rgba(254, 205, 211, 0.9);
         background: rgba(255, 241, 242, 0.95);
         }
         .lineup-node.blue .lineup-label {
         border-color: rgba(191, 219, 254, 0.95);
         background: rgba(239, 246, 255, 0.95);
         }
         .lineup-node.r-gk { top: 12%; left: 50%; }
         .lineup-node.r-dl { top: 28%; left: 35%; }
         .lineup-node.r-dr { top: 28%; left: 65%; }
         .lineup-node.r-fl { top: 44%; left: 35%; }
         .lineup-node.r-fr { top: 44%; left: 65%; }
         .lineup-node.b-gk { top: 88%; left: 50%; }
         .lineup-node.b-dl { top: 72%; left: 35%; }
         .lineup-node.b-dr { top: 72%; left: 65%; }
         .lineup-node.b-fl { top: 56%; left: 35%; }
         .lineup-node.b-fr { top: 56%; left: 65%; }
         .lineup-half-label {
         position: absolute;
         font-size: 11px;
         font-weight: 800;
         padding: 4px 8px;
         border-radius: 999px;
         background: rgba(255, 255, 255, 0.92);
         border: 1px solid rgba(203, 213, 225, 0.9);
         box-shadow: 0 2px 6px rgba(15, 23, 42, 0.12);
         }
         .lineup-half-label.red {
         top: 8px;
         left: 8px;
         color: #b91c1c;
         }
         .lineup-half-label.blue {
         bottom: 8px;
         right: 8px;
         color: #0369a1;
         }
         .lineup-bench-grid {
         display: grid;
         gap: 8px;
         margin-top: 10px;
         }
         .lineup-bench-team {
         border: 1px solid #e2e8f0;
         border-radius: 10px;
         padding: 8px;
         background: #fff;
         }
         .lineup-bench-team.red {
         border-color: #fecdd3;
         background: #fff5f6;
         }
         .lineup-bench-team.blue {
         border-color: #bfdbfe;
         background: #f0f7ff;
         }
         .lineup-bench-title {
         margin: 0 0 6px;
         font-size: 11px;
         font-weight: 700;
         color: #64748b;
         text-transform: uppercase;
         letter-spacing: 0.04em;
         }
         .bench-list {
         display: flex;
         flex-wrap: wrap;
         gap: 6px;
         }
         .bench-chip {
         display: inline-flex;
         align-items: center;
         min-height: 26px;
         padding: 4px 8px;
         border-radius: 999px;
         font-size: 11px;
         font-weight: 600;
         border: 1px solid #d7e3f4;
         background: #ffffff;
         color: #334155;
         }
         @media (max-width: 768px) {
         .modal-tab {
         font-size: 11px;
         min-height: 28px;
         min-width: 78px;
         }
         .scorer-goals {
         min-width: 32px;
         padding: 2px 6px;
         }
         .lineup-dot {
         width: 18px;
         height: 18px;
         }
         .lineup-label {
         font-size: 9px;
         padding: 3px 5px;
         }
         }
         body.theme-dark {
         --bg-a: #0b1220;
         --bg-b: #0f172a;
         --ink: #e2e8f0;
         --muted: #9fb3c8;
         --card-border: #243244;
         }
         body.theme-dark .back-btn,
         body.theme-dark #themeToggle {
         background: #142136;
         border-color: #355276;
         color: #9ad4ff;
         }
         body.theme-dark .back-btn:hover,
         body.theme-dark #themeToggle:hover {
         background: #1178c8;
         color: #fff;
         }
         body.theme-dark .match-box,
         body.theme-dark #modalBox,
         body.theme-dark .modal-tabs-shell,
         body.theme-dark .modal-info-card,
         body.theme-dark .lineup-unified-card,
         body.theme-dark .lineup-bench-team {
         background: #111b2e;
         border-color: #2b3a50;
         color: #dbe7f4;
         }
         body.theme-dark .match-meta,
         body.theme-dark .modal-subtitle,
         body.theme-dark .lineup-bench-title {
         color: #9fb3c8;
         }
         body.theme-dark .score,
         body.theme-dark .scorer-name,
         body.theme-dark #modalBox h2 {
         color: #e2e8f0;
         }
         body.theme-dark .info-link {
         background: #142136;
         border: 1px solid #355276;
         color: #9ad4ff;
         }
         body.theme-dark .info-link:hover {
         background: #1178c8;
         color: #fff;
         }
         body.theme-dark .modal-head {
         background: linear-gradient(180deg, #111b2e 0%, #0f172a 100%);
         border-color: #2b3a50;
         }
         body.theme-dark .modal-tab {
         background: #142136;
         border-color: #355276;
         color: #b9d6f2;
         }
         body.theme-dark .modal-tab:hover {
         background: #1a2b43;
         }
         body.theme-dark .modal-empty {
         background: #0f1a2c;
         border-color: #355276;
         color: #9fb3c8;
         }
         body.theme-dark .scorer-row {
         background: #16243a;
         border-color: #355276;
         }
         body.theme-dark .scorer-row.red {
         background: #2a1c28;
         border-color: #7f2f44;
         }
         body.theme-dark .scorer-row.blue {
         background: #172739;
         border-color: #315679;
         }
         body.theme-dark .scorer-goals {
         background: #0f1a2c;
         color: #dbe7f4;
         border-color: #355276;
         }
         body.theme-dark .bench-chip {
         background: #0f1a2c;
         border-color: #355276;
         color: #dbe7f4;
         }
      </style>
   </head>
   <body>
      <div class="container">
         <h1>Sve odigrane utakmice</h1>
         <div class="back-button-top">
            <a href="index.html" class="back-btn">‚Üê Nazad na rezultate</a>
            <button id="themeToggle" type="button" aria-label="Promeni temu">üåô Dark</button>
         </div>
         <div id="historyList"></div>
      </div>
      <!-- MODAL -->
      <div id="modalOverlay">
         <div id="modalBox">
            <div class="modal-head">
               <h2 id="modalTitle">Info o meƒçu</h2>
               <button id="closeModal" type="button" aria-label="Zatvori dijalog">‚úï</button>
            </div>
            <div id="modalContent"></div>
         </div>
      </div>
      <script type="module">
         import { onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
         
         let allMatches = [];
         let allPlayers = { crveni: {}, plavi: {} };
         const THEME_KEY = "termin_theme";

         function applyTheme(theme) {
           const isDark = theme === "dark";
           document.body.classList.toggle("theme-dark", isDark);
           const btn = document.getElementById("themeToggle");
           if (btn) {
             btn.textContent = isDark ? "‚òÄÔ∏è Light" : "üåô Dark";
             btn.setAttribute("aria-label", isDark ? "Prebaci na svetlu temu" : "Prebaci na tamnu temu");
           }
         }

         function initThemeToggle() {
           const btn = document.getElementById("themeToggle");
           if (!btn) return;

           let initial = "light";
           try {
             const saved = localStorage.getItem(THEME_KEY);
             if (saved === "dark" || saved === "light") {
               initial = saved;
             } else if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
               initial = "dark";
             }
           } catch (_) {}

           applyTheme(initial);

           btn.addEventListener("click", () => {
             const next = document.body.classList.contains("theme-dark") ? "light" : "dark";
             applyTheme(next);
             try {
               localStorage.setItem(THEME_KEY, next);
             } catch (_) {}
           });
         }
         
         function escapeHtml(value) {
           return String(value ?? "").replace(/[&<>"']/g, char => ({
             "&": "&amp;",
             "<": "&lt;",
             ">": "&gt;",
             '"': "&quot;",
             "'": "&#39;"
           }[char]));
         }

         const MONTHS_SHORT_SR = ["jan", "feb", "mar", "apr", "maj", "jun", "jul", "avg", "sep", "okt", "nov", "dec"];

         function formatMatchDate(dateValue) {
           const raw = String(dateValue || "").trim();
           const isoMatch = raw.match(/^(\d{4})-(\d{2})-(\d{2})$/);
           if (!isoMatch) return raw;

           const year = Number(isoMatch[1]);
           const month = Number(isoMatch[2]);
           const day = Number(isoMatch[3]);
           if (!year || month < 1 || month > 12 || day < 1 || day > 31) return raw;

           return `${day}. ${MONTHS_SHORT_SR[month - 1]} ${year}`;
         }

         function formatMatchTime(timeValue) {
           const raw = String(timeValue || "").trim();
           const timeMatch = raw.match(/^(\d{1,2}):(\d{2})$/);
           if (!timeMatch) return raw;

           const hours = Number(timeMatch[1]);
           const minutes = timeMatch[2];
           if (Number.isNaN(hours)) return raw;
           if (minutes === "00") return `${hours}h`;
           return `${hours}:${minutes}h`;
         }

         function formatMatchMeta(round, dateValue, timeValue) {
           const parts = [];
           parts.push(`Kolo ${escapeHtml(round)}`);

           const niceDate = formatMatchDate(dateValue);
           if (niceDate) parts.push(escapeHtml(niceDate));

           const niceTime = formatMatchTime(timeValue);
           if (niceTime) parts.push(escapeHtml(niceTime));

           return parts.join(" ¬∑ ");
         }
         
         /* -------- FORMAT PLAYER NAME -------- */
         function formatPlayerName(name) {
           if (!name) return '';
         
           let displayName = name;
           let badges = '';
         
           const captainRegex = /\s*\(c\)\s*/i;
           if (captainRegex.test(name)) {
             displayName = name.replace(captainRegex, ' ').trim();
             badges += '<span class="captain-badge">C</span>';
           }
         
           const goalkeeperRegex = /\s*\(g\)\s*/i;
           if (goalkeeperRegex.test(name)) {
             displayName = name.replace(goalkeeperRegex, ' ').trim();
             badges += '<span class="goalkeeper-badge">üß§</span>';
           }
         
           return escapeHtml(displayName) + badges;
         }
         
         /* LOAD ALL MATCHES */
         onValue(window.dbRef("matches"), snap => {
           const data = snap.val() || {};
           allMatches = Object.values(data).sort((a,b)=>b.timestamp - a.timestamp);
           renderHistory(allMatches);
         });
         
         /* LOAD PLAYERS */
         onValue(window.dbRef("players"), snap => {
           const players = snap.val() || {};
           allPlayers = players || { crveni: {}, plavi: {} };
         });
         
         /* RENDER HISTORY */
         function renderHistory(matches) {
           const box = document.getElementById("historyList");
           box.innerHTML = "";
         
           if (!matches.length) {
             box.innerHTML = "<div class='empty-state'>üìã Jo≈° uvek nema odigranih utakmica</div>";
             return;
           }
         
           matches.forEach((m, idx) => {
             const matchLinks = `
         ${m.info ? `<button type="button" class="info-link" onclick="openMatchInfo(${idx})">‚ÑπÔ∏è Info o meƒçu</button>` : ""}
         <button type="button" class="info-link" onclick="openMatchScorers(${idx})">‚öΩ Strelci</button>
         <button type="button" class="info-link" onclick="openMatchLineup(${idx})">üßç Sastavi</button>
         `;
         
         
             box.innerHTML += `
               <div class="match-box">
                 <div class="match-meta">
                   <div>${formatMatchMeta(m.round, m.date, m.time)}</div>
                   <div class="match-links">${matchLinks}</div>
                 </div>
         
                 <div class="match-teams">
                   <!-- CRVENI -->
                   <div class="team-col">
                     <img src="crveni.png" class="team-logo" alt="Crveni" loading="lazy" decoding="async">
                     <div class="team-name team-name-red">Crveni</div>
                   </div>
         
                   <div class="score">
         <span class="red">${escapeHtml(m.red)}</span> -
         <span class="blue">${escapeHtml(m.blue)}</span>
         </div>
         
                   <!-- PLAVI -->
                   <div class="team-col">
                     <img src="plavi.png" class="team-logo" alt="Plavi" loading="lazy" decoding="async">
                     <div class="team-name team-name-blue">Plavi</div>
                   </div>
                 </div>
               </div>
             `;
           });
         }
         
         let currentModalMatchIndex = null;
         let currentModalTab = "info";
         let modalScrollY = 0;
         
         function openModal() {
         const overlay = document.getElementById("modalOverlay");
         if (!document.body.classList.contains("modal-open")) {
         modalScrollY = window.scrollY || window.pageYOffset || 0;
         document.body.style.top = `-${modalScrollY}px`;
         document.body.classList.add("modal-open");
         }
         overlay.style.display = "flex";
         }
         
         function closeModal() {
         document.getElementById("modalOverlay").style.display = "none";
         if (!document.body.classList.contains("modal-open")) return;
         document.body.classList.remove("modal-open");
         document.body.style.top = "";
         window.scrollTo(0, modalScrollY);
         }
         
         function renderModalTabs(activeTab) {
         return `
         <div class="modal-tabs-shell">
         <div class="modal-tabs" role="tablist" aria-label="Prikaz podataka meƒça">
         <button type="button" class="modal-tab ${activeTab === "info" ? "active" : ""}" data-modal-tab="info" role="tab" aria-selected="${activeTab === "info"}">‚ÑπÔ∏è Info</button>
         <button type="button" class="modal-tab ${activeTab === "scorers" ? "active" : ""}" data-modal-tab="scorers" role="tab" aria-selected="${activeTab === "scorers"}">‚öΩ Strelci</button>
         <button type="button" class="modal-tab ${activeTab === "lineup" ? "active" : ""}" data-modal-tab="lineup" role="tab" aria-selected="${activeTab === "lineup"}">üßç Sastavi</button>
         </div>
         </div>
         `;
         }
         
         function renderInfoPanel(match) {
         const infoText = (match.info || "").trim();
         return `
         <div class="modal-panel">
         <p class="modal-subtitle">Detalji utakmice</p>
         <div class="modal-info-card">${infoText ? escapeHtml(infoText) : "Nema dodatnih informacija za ovaj meƒç."}</div>
         </div>
         `;
         }
         
         function renderScorersPanel(match) {
         const scorers = match.scorers || [];
         if (!scorers.length) {
         return `<div class="modal-panel">
         <p class="modal-subtitle">Lista strelaca</p>
         <p class="modal-empty">Nema strelaca za ovaj meƒç.</p>
         </div>`;
         }
         
         const grouped = {};
         let ownGoals = 0;
         scorers.forEach(s => {
         if (s.type === "own_goal") {
         ownGoals += 1;
         } else {
         const key = `${s.team}:${s.id}`;
         grouped[key] = (grouped[key] || 0) + 1;
         }
         });
         
         let html = `<p class="modal-subtitle">Lista strelaca</p><div class="scorers-list">`;
         const rows = Object.entries(grouped)
         .map(([key, count]) => {
         const [team, id] = key.split(":");
         const rawName = allPlayers[team]?.[id]?.name || "(nepoznat)";
         return {
         name: rawName.replace(/\s*\(c\)|\s*\(g\)/gi, "").trim(),
         displayName: rawName,
         teamClass: team === "crveni" ? "red" : "blue",
         count
         };
         })
         .sort((a, b) => {
         if (b.count !== a.count) return b.count - a.count;
         return a.name.localeCompare(b.name, "sr");
         });
         
         rows.forEach((item, idx) => {
         html += `
         <div class="scorer-row ${item.teamClass}">
         <div class="scorer-main">
         <div class="scorer-name">${formatPlayerName(item.displayName)}</div>
         </div>
         <span class="scorer-goals ${item.teamClass}">‚öΩ ${item.count}</span>
         </div>
         `;
         });
         html += "</div>";
         
         if (ownGoals > 0) {
         html += `<div class="own-goal-note">Autogolovi na meƒçu: ${ownGoals}</div>`;
         }
         
         return `<div class="modal-panel">${html}</div>`;
         }
         
         function renderLineupPanel(match) {
         const redPlayers = Object.entries(match.played || {})
         .filter(([_, team]) => team === "crveni")
         .map(([id]) => allPlayers.crveni?.[id]?.name || "(nepoznat)");
         
         const bluePlayers = Object.entries(match.played || {})
         .filter(([_, team]) => team === "plavi")
         .map(([id]) => allPlayers.plavi?.[id]?.name || "(nepoznat)");
         
         const stripTags = (name) => String(name || "(nepoznat)")
         .replace(/\s*\(c\)\s*/gi, " ")
         .replace(/\s*\(g\)\s*/gi, " ")
         .replace(/\s+/g, " ")
         .trim() || "(nepoznat)";
         
         const buildFive = (players) => {
         if (!players.length) return { five: [], bench: [] };
         const mapped = players.map(name => ({
         name,
         clean: stripTags(name),
         isGoalkeeper: /\(\s*g\s*\)/i.test(name)
         }));
         const gkIndex = mapped.findIndex(p => p.isGoalkeeper);
         const gk = gkIndex >= 0 ? mapped[gkIndex] : mapped[0];
         const outfield = mapped.filter((_, idx) => idx !== (gkIndex >= 0 ? gkIndex : 0));
         return { five: [gk, ...outfield.slice(0, 4)], bench: outfield.slice(4).map(p => p.clean) };
         };
         
         const renderNodes = (five, teamClass, positions) => positions.map((pos, idx) => {
         const p = five[idx];
         if (!p) return "";
         return `
         <div class="lineup-node ${teamClass} ${pos}">
         <span class="lineup-dot" aria-hidden="true"></span>
         <span class="lineup-label">${escapeHtml(p.clean)}</span>
         </div>
         `;
         }).join("");
         
         const red = buildFive(redPlayers);
         const blue = buildFive(bluePlayers);
         
         if (!red.five.length && !blue.five.length) {
         return `<div class="modal-panel">
         <p class="modal-subtitle">Sastavi ekipa</p>
         <p class="modal-empty">Nema podataka</p>
         </div>`;
         }
         
         const redNodes = renderNodes(red.five, "red", ["r-gk", "r-dl", "r-dr", "r-fl", "r-fr"]);
         const blueNodes = renderNodes(blue.five, "blue", ["b-gk", "b-dl", "b-dr", "b-fl", "b-fr"]);
         
         const renderBench = (teamClass, title, bench) => {
         if (!bench.length) return "";
         return `
         <div class="lineup-bench-team ${teamClass}">
         <p class="lineup-bench-title">${title} klupa</p>
         <div class="bench-list">${bench.map(name => `<span class="bench-chip">${escapeHtml(name)}</span>`).join("")}</div>
         </div>
         `;
         };
         
         return `
         <div class="modal-panel">
         <p class="modal-subtitle">Sastavi ekipa</p>
         <div class="lineup-unified-card">
         <div class="lineup-pitch">
         <span class="lineup-half-label red">üî¥ Crveni</span>
         <span class="lineup-half-label blue">üîµ Plavi</span>
         ${redNodes}
         ${blueNodes}
         </div>
         <div class="lineup-bench-grid">
         ${renderBench("red", "Crveni", red.bench)}
         ${renderBench("blue", "Plavi", blue.bench)}
         </div>
         </div>
         </div>
         `;
         }
         
         function renderModalCurrentTab() {
         if (currentModalMatchIndex == null) return;
         const match = allMatches[currentModalMatchIndex];
         if (!match) return;
         let panel = "";
         
         if (currentModalTab === "scorers") {
         panel = renderScorersPanel(match);
         document.getElementById("modalTitle").innerText = "Strelci na meƒçu";
         } else if (currentModalTab === "lineup") {
         panel = renderLineupPanel(match);
         document.getElementById("modalTitle").innerText = "üßç Sastavi";
         } else {
         panel = renderInfoPanel(match);
         document.getElementById("modalTitle").innerText = "‚ÑπÔ∏è Info o meƒçu";
         }
         
         document.getElementById("modalContent").innerHTML = `${renderModalTabs(currentModalTab)}${panel}`;
         }
         
         window.openMatchInfo = idx => {
         currentModalMatchIndex = idx;
         currentModalTab = "info";
         renderModalCurrentTab();
         openModal();
         };
         
         window.openMatchScorers = idx => {
         currentModalMatchIndex = idx;
         currentModalTab = "scorers";
         renderModalCurrentTab();
         openModal();
         };
         
         window.openMatchLineup = idx => {
         currentModalMatchIndex = idx;
         currentModalTab = "lineup";
         renderModalCurrentTab();
         openModal();
         };
         
         document.getElementById("modalContent").addEventListener("click", e => {
         const tabButton = e.target.closest("button[data-modal-tab]");
         if (!tabButton) return;
         currentModalTab = tabButton.dataset.modalTab;
         renderModalCurrentTab();
         });
         
         document.getElementById("closeModal").onclick = () => closeModal();
         document.getElementById("modalOverlay").onclick = e => {
         if (e.target.id === "modalOverlay") closeModal();
         };
         document.addEventListener("keydown", e => {
         if (e.key === "Escape") closeModal();
         });
         initThemeToggle();
      </script>
   </body>
</html>
